<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="user-scalable=no">
		<meta name="x5-page-mode" content="app"/>
		<meta name="apple-mobile-web-app-status-bar-style" content="-webkit-linear-gradient( right,#40a1ff,#29c4fc)"/>
		<title></title>
		<link rel="stylesheet" href="css/index.css">
		<!--<script src="https://code.jquery.com/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>-->
		<script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/jQuery.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/index.js"></script>
	</head>
	<body>
		<div id="jx_pay">
			<div class="content">
				<!--<header>
					<div class="left_head">
						<span class="back_border"></span>
						<p class="title">返回</p>
					</div>
					<p class="title_content">向商户付款</p>
				</header>-->
				<div class="shop_row">
					<div class="svg_parent" >
						<div class="logo" style=" background-repeat: no-repeat; background-image: url(svg/shop1.svg); background-size: 100% 100%;"></div>
					</div>
					<div class="shop_name">
						<h2> <span class="left_name">店铺测试</span> <span class="right_name">添加备注</span></h2>
						<div class="store">
							<span class="store_name">门店</span>
							<span class="store_content">我是门店12</span>
						</div>
					</div>
				</div>
				<!--输入金额-->
				<div class="import_box">
					<div class="import_content">
						<span class="money">消费金额</span>
						<div class="inputs">
							<span class="rnb">￥</span>
							<span id="money" class="import_pay"></span>
							<i class="cursor"></i>
							<!--<input readonly id="money" class="import_pay" type="text">-->
						</div>
					</div>
				</div>
				<!--按键-->
				<div class="key">
					<div>
						<div class="key_row">
							<span onclick="return btnNum_onclick(1,this)">1</span>
							<span onclick="return btnNum_onclick(2,this)">2</span>
							<span onclick="return btnNum_onclick(3,this)">3</span>
							<span onclick="return delText(this)">
								<i class="delete" style=" background-repeat: no-repeat;
														  background-image: url(svg/delete.svg);
														  background-size: 100% 100%;">
								</i>
							</span>
						</div>
						<div class="separate">
							<div class="right_separate">
								<div class="key_row">
									<span onclick="return btnNum_onclick(4,this)">4</span>
									<span onclick="return btnNum_onclick(5,this)">5</span>
									<span onclick="return btnNum_onclick(6,this)">6</span>
								</div>
								<div class="key_row">
									<span onclick="return btnNum_onclick(7,this)">7</span>
									<span onclick="return btnNum_onclick(8,this)">8</span>
									<span onclick="return btnNum_onclick(9,this)">9</span>
								</div>
								<div class="key_row">
									<span onclick="return btnNum_onclick(0,this)" style="flex: 2;">0</span>
									<span onclick="return btnNum_onclick('.',this)">.</span>
								</div>
							</div>
							<div class="left_separate"  id="separate">
								<span class="notarize">
									确认支付
								</span>
							</div>
						</div>

					</div>
				</div>
			</div>
		</div>
		<script>

			var  typePay = 'wxpay';
            function IsWeixinOrAlipay(){
                let ua = window.navigator.userAgent.toLowerCase();
                //判断是不是微信
                if ( ua.match(/MicroMessenger/i) == 'micromessenger' ) {
                    // return "WeiXIN";
                    typePay = 'wxpay'
                    function onBridgeReady(){   // 隐藏右上角功能
                        WeixinJSBridge.call('hideOptionMenu');
                    }

                    if (typeof WeixinJSBridge == "undefined"){
                        if( document.addEventListener ){
                            document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
                        }else if (document.attachEvent){
                            document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
                            document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
                        }
                    }else{
                        onBridgeReady();
                    }
                }else
                //判断是不是支付宝
                if (ua.match(/AlipayClient/i) == 'alipayclient') {
                    typePay = 'alipay'
                    AlipayJSBridge.call('setTitle', {
                        title: '向商户付款',
                    });
                    AlipayJSBridge.call("setTitleColor", {
                        color: 3128310,
                        reset: false //(可选,默认为false)  是否重置title颜色为默认颜色。
                    });
                    // return "Alipay";
                }
                //哪个都不是
                return  false
            }
            IsWeixinOrAlipay();
            function getUrl (){
                let data = {
                    "type":0,
                    "account":"gh_81a0e00e0e34",
                    "url":window.location.href
                };
                $.ajax({
                    type: 'POST',
                    contentType:'application/json',
                    url: "https://lile95.github.io/pay/",
                    data: JSON.stringify(data),
                    xhrFields: {
                        withCredentials: true    // 前端设置是否带cookie
                    },
                    crossDomain: true,   // 会让请求头中包含跨域的额外信息，但不会含cookie
                    success: function(res){
                        console.log(res.data.data);
                        open(res.data)
                        alert(window.location)
                    }});
			}
            getUrl();

			$('#separate').on('click',function() {
				// alert(typePay)
				let money = document.getElementById("money").innerHTML;
				let data = {
				"money":money,
				"mchnt_cd":'0005810F1719044',
				"type":typePay,
				"notify_url":'https://www.baidu.com',
				"return_url":'https://www.baidu.com',
				"out_trade_no":'123456',
				"name":'向商家付款',
				"site_name":'百度'
			  };
			  $.ajax({
				type: 'POST',
				contentType:'application/json',
				url: "http://192.168.0.16:8088/api/pay/micropay",
				data: JSON.stringify(data),
				  xhrFields: {
					  withCredentials: true    // 前端设置是否带cookie
				  },
				  crossDomain: true,   // 会让请求头中包含跨域的额外信息，但不会含cookie
				success: function(res){
					if (res.code == 0){
						window.open(res.data.qr_code);
					}
					console.log(res);
				}});
			});
		// alert(window.location)
		</script>
	</body>
</html>
