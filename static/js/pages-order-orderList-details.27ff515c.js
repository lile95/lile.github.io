(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-order-orderList-details"],{"05c5":function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,"[data-v-ea230f84] .pay-type{padding:0 0 %?30?%!important}.content[data-v-ea230f84]{padding:%?20?% %?24?%}.order-title[data-v-ea230f84]{font-size:%?38?%;font-weight:700;color:#332f2e}.orderInfo[data-v-ea230f84]{padding-bottom:%?20?%}.order-info-title[data-v-ea230f84]{font-size:%?26?%;color:#000;font-weight:700;height:%?100?%;line-height:%?100?%;border-bottom:%?2?% solid #eee}.row[data-v-ea230f84]{display:-webkit-box;display:-webkit-flex;display:flex;padding:%?30?% %?18?% 0}.row .title[data-v-ea230f84]{opacity:.6;font-size:%?26?%;color:#332f2e}.row .value[data-v-ea230f84]{font-size:%?26?%;-webkit-box-flex:1;-webkit-flex:1;flex:1;color:#000;text-align:right}.btn[data-v-ea230f84]{padding-top:%?30?%}.btn .btn-botton[data-v-ea230f84]{display:-webkit-box;display:-webkit-flex;display:flex;position:-webkit-sticky;position:sticky;bottom:%?64?%}.btn .btn-botton uni-button[data-v-ea230f84]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.btn .waiting[data-v-ea230f84]{background:#332f2e;color:#fff;font-size:%?32?%}.btn .cell-btn[data-v-ea230f84]{height:%?88?%;line-height:%?88?%;margin-right:%?20?%;color:#666;-webkit-box-shadow:0 0 %?19?% %?1?% rgba(0,0,0,.2);box-shadow:0 0 %?19?% %?1?% rgba(0,0,0,.2)}.btn .off-btn[data-v-ea230f84]{height:%?88?%;line-height:%?88?%;width:80%;background-color:#f63100;color:#fff;-webkit-box-shadow:0 0 %?19?% %?1?% rgba(0,0,0,.35);box-shadow:0 0 %?19?% %?1?% rgba(0,0,0,.35)}.my-menu[data-v-ea230f84]{padding:%?30?% %?18?% 0;background-color:#fff;-webkit-border-radius:%?8?%;border-radius:%?8?%;position:relative}.my-menu .my-menu-title[data-v-ea230f84]{color:#332f2e;font-size:%?26?%;padding-bottom:%?40?%;font-weight:600}.my-menu .my-menu-list[data-v-ea230f84]{position:relative;overflow:hidden;-webkit-transition:height .5s;transition:height .5s}.my-menu .unfold[data-v-ea230f84]{background-image:-webkit-gradient(linear,left top,left bottom,from(hsla(0,0%,100%,0)),color-stop(70%,#fff));background-image:-webkit-linear-gradient(top,hsla(0,0%,100%,0),#fff 70%);background-image:linear-gradient(-180deg,hsla(0,0%,100%,0),#fff 70%);position:absolute;bottom:0;text-align:center;width:100%}.my-menu .unfold .readmore[data-v-ea230f84]{font-size:%?22?%;padding:%?30?% 0;color:#777}.popup-content[data-v-ea230f84]{width:%?540?%}.popup-content .row[data-v-ea230f84]{display:-webkit-box;display:-webkit-flex;display:flex;width:100%;padding:0}.popup-content .btn-box[data-v-ea230f84]{-webkit-box-flex:1;-webkit-flex:1;flex:1}.popup-content .cancel[data-v-ea230f84]{padding-right:%?20?%}.popup-content .cancel uni-button[data-v-ea230f84]{color:#333;background-color:#f8f8f8}.popup-content uni-button[data-v-ea230f84]{height:%?88?%;background-color:#2396ff;color:#fff;line-height:%?88?%}.popup-content uni-textarea[data-v-ea230f84]{width:100%}\n/* 提示窗口 */.uni-tip[data-v-ea230f84]{padding:15px;width:300px;background:#fff;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-border-radius:10px;border-radius:10px}.uni-tip-title[data-v-ea230f84]{text-align:center;font-weight:700;font-size:16px;color:#333}.uni-tip-content[data-v-ea230f84]{padding:15px;font-size:14px;color:#666}.uni-tip-group-button[data-v-ea230f84]{margin-top:10px;display:-webkit-box;display:-webkit-flex;display:flex}.uni-tip-button[data-v-ea230f84]{width:100%;text-align:center;font-size:14px;color:#3b4144}",""]),t.exports=e},"0d43":function(t,e,i){"use strict";var a=i("58e4"),n=i.n(a);n.a},"20e0":function(t,e,i){"use strict";i.r(e);var a=i("d719"),n=i("7725");for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("0d43");var s,r=i("f0c5"),d=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"ea230f84",null,!1,a["a"],s);e["default"]=d.exports},"58e4":function(t,e,i){var a=i("05c5");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("497ff8ce",a,!0,{sourceMap:!1,shadowMode:!1})},"61bd":function(t,e,i){"use strict";var a=i("ee27");i("4160"),i("c975"),i("26e9"),i("ac1f"),i("466d"),i("159b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;i("1956");var n=i("1335"),o=a(i("a483")),s=a(i("e487")),r=a(i("5f64")),d={components:{myMenu:o.default,payType:s.default,uniPopup:r.default},data:function(){return{list:[{name:"订单编号",value:"orderId",unit:""},{name:"下单时间",value:"createTime",unit:""},{name:"包装费",value:"pageFee",unit:"元"},{name:"配送费",value:"deliverFee",unit:"元"},{name:"优惠金额",value:"actAmount",unit:"元"}],peopleShow:!1,details:{},urlOptions:{},orderInfo:{},isUnfold:!1,loading:!1,payType:0,upCoupons:0,isVipdis:1,MemberInfo:{},orderId:"",countPrice:{},tuiValue:"",showPopup:!1,show:!1,orderlist:[],pullOrder:!1,isOpenedPay:null,timer:null,prepay:null,beforehanding:!1,peopleNum:1,shopInfo:{},shopId:""}},computed:{isOrderStatus:function(){return 1==this.details.orderStatus?"已接单":5==this.details.orderStatus?"已取消":6==this.details.orderStatus?"申请退单":6==this.details.orderStatus?"已退单":void 0},beforehand:function(){return this.orderInfo.tableId!=this.urlOptions.table&&0==this.orderInfo.tableId&&void 0!=this.urlOptions.table},orderLength:function(){var t=0;return this.orderInfo.additional&&this.orderInfo.additional.forEach((function(e){e.info.forEach((function(e){t++}))})),t},showPay:function(){return 1==this.orderInfo.wmtype||(0!==this.prepay||0===this.isOpenedPay&&this.pullOrder)}},destroyed:function(){this.timer&&clearInterval(this.timer)},onLoad:function(t){var e=this;console.log(t),this.orderId=t.orderId,t.shopId&&(this.shopId=t.shopId);try{this.urlOptions=JSON.parse(uni.getStorageSync("wx_url_Info")),this.shopInfo=JSON.parse(uni.getStorageSync("wx_shop_Info_Order")),this.getMemberInfo(),this.getDetails(),this.$refs.payType.getCouponList()}catch(i){}this.getContPrice(t),this.timer=setInterval((function(){e.getDetails()}),8e3),setTimeout((function(){clearInterval(e.timer)}),18e4)},methods:{setPeople:function(){var t=this,e={shopId:this.shopId,orderId:this.orderInfo.orderId,peopleNum:this.peopleNum,tableId:this.urlOptions.table,openId:uni.getStorageSync("isWxMemberOpenId")};(0,n.confirm)(e).then((function(e){console.log(e),0===e.data.status?(t.getDetails(),t.timer=setInterval((function(){t.getDetails()}),8e3),setTimeout((function(){clearInterval(t.timer)}),18e4),uni.showToast({title:"已确认预点单",icon:"success",mask:!0,duration:2e3})):uni.showToast({title:e.data.message,icon:"none",mask:!0,duration:2e3})})).catch((function(t){})),this.$store.state.peopleNum=this.peopleNum,this.peopleShow=!1},cancelOrder:function(){var t=this;uni.showModal({title:"提示",content:"确认取消订单",success:function(e){if(e.confirm){var i={openId:uni.getStorageSync("isWxMemberOpenId"),shopId:t.shopId,orderId:t.orderId,wmtype:1,tableId:0};(0,n.cancelwm)(i).then((function(e){console.log(e),uni.showToast({title:e.data.message,icon:"none",mask:!0,duration:2e3}),0===e.data.status&&t.getDetails()}))}else e.cancel&&console.log("用户点击取消")}})},chargeback:function(){var t=this,e={openId:uni.getStorageSync("isWxMemberOpenId"),shopId:this.shopId,orderId:this.orderId,reason:this.tuiValue};(0,n.tuiwm)(e).then((function(e){console.log(e),0==e.data.status&&(uni.showModal({title:"提示",content:e.data.message}),t.showPopup=!1,t.getDetails())})).catch((function(e){t.showPopup=!1}))},cancel:function(){this.showPopup=!1},togglePopup:function(){this.showPopup=!0},getContPrice:function(t){var e=this,i={openId:uni.getStorageSync("isWxMemberOpenId"),shopId:this.shopId,tableId:"0",orderId:t.orderId,codes:this.$store.state.couponChecks,isVipdis:this.isVipdis};1!=this.upCoupons&&(i.codes=null),(0,n.discountPrice)(i).then((function(t){0==t.data.status?e.countPrice=t.data.data:uni.showModal({title:"提示",content:t.data.message})})).catch((function(t){}))},submit:function(){0==this.payType?this.pay():1==this.payType&&this.membersPay()},getMemberInfo:function(){var t=this,e={openId:uni.getStorageSync("isWxMemberOpenId"),shopId:this.shopId};console.log(this.urlOptions),(0,n.getCrmCard)(e).then((function(e){t.MemberInfo=e.data.data})).catch((function(t){}))},checkChenge:function(t,e,i){this[t]==e&&i?this[t]=0:this[t]=e,i&&this.getContPrice({orderId:this.orderId})},mgr:function(t){uni.showToast({title:t,icon:"success",mask:!0,duration:2e3})},readmore:function(){this.isUnfold=!this.isUnfold},getDetails:function(){var t=this,e={orderId:this.orderId,vipOpenId:uni.getStorageSync("isWxMemberOpenId"),openId:uni.getStorageSync("isWxAppletOpenId"),shopId:this.shopId};(0,n.orderDetails)(e).then((function(e){t.orderInfo=e.data.data,t.details=e.data.data,t.$store.state.payAmount=e.data.data.amount,1==e.data.data.preOrder?(t.beforehanding=!0,clearInterval(t.timer)):t.beforehanding=!1,t.isOpenedPay=e.data.data.isOpenedPay,t.prepay=e.data.data.prepay,t.orderlist=e.data.data.additional.reverse();var i=[];t.orderlist.forEach((function(t){t.info.forEach((function(t){i.push(t.status)}))})),t.pullOrder=-1===i.indexOf(0),t.showPay&&clearInterval(t.timer),t.show=!0})).catch((function(e){t.show=!0}))},membersPay:function(){var t=this;this.loading=!0;var e={openId:uni.getStorageSync("isWxMemberOpenId"),shopId:this.shopId,orderId:this.details.orderId,codes:this.$store.state.couponChecks,isVipdis:this.isVipdis};1!=this.upCoupons&&(e.codes=null),(0,n.memberPay)(e).then((function(e){console.log(e),0==e.data.status?(uni.showToast({title:"支付成功",icon:"success",mask:!0,duration:2e3}),setTimeout((function(){t.loading=!1,uni.navigateBack()}),2e3)):uni.showModal({title:"提示",content:e.data.message})})).catch((function(e){t.loading=!1}))},pay:function(){var t=this,e={orderId:this.details.orderId,openId:uni.getStorageSync("isWxAppletOpenId"),vipOpenId:uni.getStorageSync("isWxMemberOpenId"),shopId:this.shopId,type:"wxpay",appId:wx.getAccountInfoSync().miniProgram.appId,isVipdis:this.isVipdis,codes:this.$store.state.couponChecks};1!=this.upCoupons&&(e.codes=null),(0,n.pay)(e).then((function(e){if(console.log(e),"alipayclient"==ua.match(/AlipayClient/i))window.location.href=e.data.data.qr_code;else if("micromessenger"==ua.match(/MicroMessenger/i)){var i=t;if(0===e.data.code){var a=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.data.data.sdk_appid,timeStamp:e.data.data.sdk_timestamp,nonceStr:e.data.data.sdk_noncestr,package:e.data.data.sdk_package,signType:e.data.data.sdk_signtype,paySign:e.data.data.sdk_paysign},(function(t){i.wxtext=t,"get_brand_wcpay_request:ok"===t.err_msg?(i.$store.state.onceAgain=!0,that.getDetails(),that.$store.state.couponChecks=""):uni.showModal({title:"提示",content:t.err_desc,success:function(t){}})}))};e.data.data.disabledTime;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",a,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",a),document.attachEvent("onWeixinJSBridgeReady",a)):a()}else t.$message({message:e.data.message,duration:5e3})}})).catch((function(t){}))},status:function(){return this.details.orderStatus>4?5==this.details.orderStatus?"已取消":"已退单":this.details.payStatus?"已支付":void 0}}};e.default=d},7725:function(t,e,i){"use strict";i.r(e);var a=i("61bd"),n=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},d719:function(t,e,i){"use strict";var a={uniIcons:i("f5dfd").default,uniPopup:i("5f64").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"content"},[t.details.orderStatus>4?i("v-uni-view",{staticClass:"order-title"},[t._v("订单"+t._s(t.isOrderStatus))]):i("v-uni-view",{staticClass:"order-title"},[t._v("订单"+t._s(t.details.payStatus>=1?"已支付":"未支付"))]),i("v-uni-view",{staticClass:"my-menu"},[i("v-uni-view",{staticClass:"my-menu-title"},[t._v("我的菜单")]),i("v-uni-view",{staticClass:"my-menu-list",style:{height:t.isUnfold||t.orderLength<=3?126*t.orderLength+"rpx":"380rpx"}},t._l(t.orderInfo.additional,(function(t,e){return i("v-uni-view",{key:e},[i("myMenu",{attrs:{menuList:t.info,detail:!0}})],1)})),1),t.orderLength>3?i("v-uni-view",{staticClass:"unfold"},[i("v-uni-view",{staticClass:"readmore",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.readmore.apply(void 0,arguments)}}},[t._v("展开更多"),i("uni-icons",{attrs:{type:"arrowdown",color:"#777"}})],1)],1):t._e()],1),i("v-uni-view",{staticClass:"btn"},[t.details.orderStatus>4?i("v-uni-view"):i("v-uni-view",[t.details.payStatus>=1&&1==t.shopInfo.wmTui?i("v-uni-button",{staticClass:"off-btn",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.togglePopup.apply(void 0,arguments)}}},[t._v("申请退单")]):t.beforehanding?i("v-uni-view",[i("v-uni-view",{staticClass:"btn-botton"},[t.beforehand?i("v-uni-button",{staticClass:"off-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.peopleShow=!0}}},[t._v("预点单确认")]):i("v-uni-button",{staticClass:"off-btn"},[t._v("预 点 单")])],1)],1):i("v-uni-view",[i("pay-type",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],ref:"payType",attrs:{payType:t.payType,isVipdis:t.isVipdis,upCoupons:t.upCoupons,MemberInfo:t.MemberInfo,countPrice:t.countPrice},on:{checkChenge:function(e){arguments[0]=e=t.$handleEvent(e),t.checkChenge.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"btn-botton"},[1==t.details.wmtype?i("v-uni-button",{staticClass:"cell-btn",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.cancelOrder.apply(void 0,arguments)}}},[t._v("取消订单")]):t._e(),t.showPay?i("v-uni-button",{staticClass:"off-btn",attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v("确认支付")]):i("v-uni-button",{staticClass:"waiting",attrs:{type:"default"}},[t._v("待接单")])],1)],1)],1)],1),i("v-uni-view",{staticClass:"order-info"},[i("v-uni-view",{staticClass:"order-info-title"},[t._v("订单信息")]),t._l(t.list,(function(e,a){return t.orderInfo[e.value]?i("v-uni-view",{key:a,staticClass:"row"},[i("v-uni-view",{staticClass:"title"},[t._v(t._s(e.name))]),i("v-uni-view",{staticClass:"value"},[t._v(t._s(t.orderInfo[e.value])+" "+t._s(e.unit))])],1):t._e()})),t.orderInfo.tableId?i("v-uni-view",{staticClass:"row"},[i("v-uni-view",{staticClass:"title"},[t._v("桌号")]),i("v-uni-view",{staticClass:"value"},[t._v(t._s(t.orderInfo.tableId))])],1):t._e(),t.orderInfo.peopleNum&&1!=t.orderInfo.wmtype?i("v-uni-view",{staticClass:"row"},[i("v-uni-view",{staticClass:"title"},[t._v("就餐人数")]),i("v-uni-view",{staticClass:"value"},[t._v(t._s(t.orderInfo.peopleNum))])],1):t._e(),i("v-uni-view",{staticClass:"row"},[i("v-uni-view",{staticClass:"title"},[t._v("合计金额")]),t.countPrice.afterAmount-t.countPrice.ticketAmount?i("v-uni-view",{staticClass:"value"},[t._v(t._s(t.countPrice.afterAmount-t.countPrice.ticketAmount)+"元")]):i("v-uni-view",{staticClass:"value"},[t._v(t._s(t.orderInfo.amount)+"元")])],1)],2),i("uni-popup",{ref:"popup",attrs:{type:"center",id:"popup-tui",show:t.showPopup,"mask-click":!1}},[i("v-uni-view",{staticClass:"popup-content"},[i("v-uni-textarea",{attrs:{"placeholder-style":"color:#F76260",placeholder:"请输入退单原因"},model:{value:t.tuiValue,callback:function(e){t.tuiValue=e},expression:"tuiValue"}}),i("v-uni-view",{staticClass:"row"},[i("v-uni-view",{staticClass:"btn-box cancel"},[i("v-uni-button",{attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.cancel.apply(void 0,arguments)}}},[t._v("取消")])],1),i("v-uni-view",{staticClass:"btn-box"},[i("v-uni-button",{attrs:{type:"default"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.chargeback.apply(void 0,arguments)}}},[t._v("提交")])],1)],1)],1)],1),i("uni-popup",{attrs:{show:t.peopleShow,type:"center",custom:!0,"mask-click":!1}},[i("v-uni-view",{staticClass:"uni-tip"},[i("v-uni-view",{staticClass:"uni-tip-title"},[t._v("确认预点单")]),i("v-uni-view",{staticClass:"uni-tip-content"},[t._v("请输入用餐人数"),i("v-uni-input",{staticClass:"num",attrs:{type:"number",maxlength:"2",focus:!0,"placeholder-style":"color:rgb(229, 229, 229)",placeholder:"请输入",value:""},model:{value:t.peopleNum,callback:function(e){t.peopleNum=e},expression:"peopleNum"}})],1),i("v-uni-view",{staticClass:"uni-tip-group-button"},[i("v-uni-view",{staticClass:"uni-tip-button",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.peopleShow=!1}}},[t._v("取消")]),i("v-uni-view",{staticClass:"uni-tip-button",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setPeople("tip")}}},[t._v("确定")])],1)],1)],1)],1)},o=[];i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}))}}]);